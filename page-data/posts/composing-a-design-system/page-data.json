{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/composing-a-design-system/","result":{"data":{"markdownRemark":{"id":"14e672e5-183b-53a2-9ea8-9e8163c23c65","html":"<div class=\"image-container\">\n    <img src=\"/media/composing-a-design-system/banner.png\"/>\n</div>\nAt my organization, we are heavy users of Design System across multiple apps and have built two iterations of our in-house design system in the last few years. Maintaining a Design System also meant finding creative ways to bridge the gap between Design Platforms(Sketch, Figma etc) and Mobile Platforms(Android, iOS). I've been experimenting with Jetpack Compose to rebuild our custom design system and this blog is a summary of what I found:\n<ul>\n<li><a href=\"#design-system-basics\">Design System Basics</a></li>\n<li><a href=\"#working-with-colors-and-gradients\">Working with Colors and Gradients</a></li>\n<li><a href=\"#managing-typography\">Managing Typography</a></li>\n<li><a href=\"#spacings-shapes-and-shadows\">Spacings, Shapes and Shadows</a></li>\n<li><a href=\"#theming-and-compositionlocal\">Theming and CompositionLocal</a></li>\n<li><a href=\"#components\">Components</a></li>\n<li><a href=\"#backward-compatibility-and-migration\">Backward Compatibility and Migration</a></li>\n<li><a href=\"#final-thoughts\">Final Thoughts</a></li>\n</ul>\n<h2 id=\"design-system-basics\" style=\"position:relative;\"><a href=\"#design-system-basics\" aria-label=\"design system basics permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Design System Basics</h2>\n<p>A Design System represents the blueprint of an appâ€™s brand. Design cues often make an app recognisable, even when they are presented out of context. Consider logos of various brands and their color definition(Mcdonaldâ€™s M with yellow color, Facebookâ€™s f with blue color).\nA Design System makes sure your user doesnâ€™t feel alienated within your app as he traverses different flows of your product. Such a system is defined with very granular properties of Design: Colors and Typography with additional attributes such as shadows, shapes, spacings, gradients etc.</p>\n<h2 id=\"working-with-colors-and-gradients\" style=\"position:relative;\"><a href=\"#working-with-colors-and-gradients\" aria-label=\"working with colors and gradients permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Working with Colors and Gradients</h2>\n<p>A UI framework can be easily judged by the way it handles design primitive properties such as Colors. Android XML failed miserably at this because the only way you could represent color in it was hex code. The number of times I have received rgba properties from Designers and I had to ask them please provide hex codes because thatâ€™s the only format we can support via XML, always felt stupid. Now donâ€™t get me wrong, hex codes are easy and there are ways to convert rgba to hex easily whether itâ€™s manual or automated, but it always made me feel I was speaking a different language than Designers.</p>\n<p>Compose ditching XML means there is only one language left to define color which has a very good definition for the same.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">//RGB with alpha</span>\n<span class=\"token keyword\">val</span> color <span class=\"token operator\">=</span> <span class=\"token function\">Color</span><span class=\"token punctuation\">(</span>red <span class=\"token operator\">=</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">,</span> green <span class=\"token operator\">=</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">,</span> blue <span class=\"token operator\">=</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">,</span> alpha <span class=\"token operator\">=</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">val</span> color <span class=\"token operator\">=</span> <span class=\"token function\">Color</span><span class=\"token punctuation\">(</span>red <span class=\"token operator\">=</span> <span class=\"token number\">1f</span><span class=\"token punctuation\">,</span> green <span class=\"token operator\">=</span> <span class=\"token number\">1f</span><span class=\"token punctuation\">,</span> blue <span class=\"token operator\">=</span> <span class=\"token number\">1f</span><span class=\"token punctuation\">,</span> alpha <span class=\"token operator\">=</span> <span class=\"token number\">1f</span><span class=\"token punctuation\">,</span> ColorSpace<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>ColorSpaces<span class=\"token punctuation\">.</span>Srgb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">//ARGB Integer</span>\n<span class=\"token keyword\">val</span> color <span class=\"token operator\">=</span> <span class=\"token function\">Color</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xFF000080</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>Gradients</strong></p>\n<p>If you want to standardize gradients in your app, itâ€™s hard. Here are few ways to create gradients in Android</p>\n<ul>\n<li>If you have a Vector, you can add a <code class=\"language-text\">&lt;gradient></code> tag inside xml. Want to do this outside of xml, forget it.</li>\n<li>Above step is same if you have an Shape xml.</li>\n<li>You can create <code class=\"language-text\">GradientDrawable</code> programmatically, but it only takes specific shapes like <code class=\"language-text\">oval</code>, <code class=\"language-text\">rectangle</code> etc.</li>\n</ul>\n<p>Creating a central API to create/apply gradient with a shape/drawable is hard. The only way is to convert the whole Drawable to Bitmap, add shader to it and bam you get back gradient laden <code class=\"language-text\">BitmapDrawable</code>(YOLO)</p>\n<p>Better ways are here. Compose abstracted away everything related to <code class=\"language-text\">Drawable</code> to <code class=\"language-text\">Painter</code> classes(This also helps avoid all issues with Drawables in general but that probably needs a different blog post).</p>\n<p>Similar to <code class=\"language-text\">Color</code>, Compose has a <code class=\"language-text\">Brush</code> API which allows you to define how to paint the content. The API is very generic since you can create a <code class=\"language-text\">Brush</code> instance for Gradient or a Solid Color, very handy for creating an API where you donâ€™t know whether the consumer of your component would apply a Solid Color or a Gradient.</p>\n<p><code class=\"language-text\">Shape</code> class allows you to define shapes as well without any correlation with how the shape will be painted.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\">Modifier<span class=\"token punctuation\">.</span><span class=\"token function\">background</span><span class=\"token punctuation\">(</span>\n    brush <span class=\"token operator\">=</span> Brush<span class=\"token punctuation\">.</span><span class=\"token function\">linearGradient</span><span class=\"token punctuation\">(</span><span class=\"token function\">listOf</span><span class=\"token punctuation\">(</span>startColor<span class=\"token punctuation\">,</span> endColor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    shape <span class=\"token operator\">=</span> CircleShape\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>By creating an extension on <code class=\"language-text\">Modifier</code>, this allows us to create a central API for applying design specific gradients abstracting out properties like angles, stops etc from end users.</p>\n<h2 id=\"managing-typography\" style=\"position:relative;\"><a href=\"#managing-typography\" aria-label=\"managing typography permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Managing Typography</h2>\n<p>Iâ€™ve been developing applications since before xml support was added for font files. Before that, it was a constant effort around <code class=\"language-text\">Typeface</code> APIs to make sure custom fonts were managed and applied properly everywhere(Do you even <em>Calligraphy</em> bro ðŸ˜› ). </p>\n<p>Ever since fonts got support for xml, managing styles for <code class=\"language-text\">TextView</code> was far better. The existing system still suffers from certain hiccups</p>\n<ul>\n<li>Setting styles programmatically using <code class=\"language-text\">setTextAppearance</code> does not respect line height.</li>\n<li>Classes like <code class=\"language-text\">EditText</code> subclass <code class=\"language-text\">TextView</code> and can apply the same styles. However line height behaviours are quite inconsistent when fields are editable, which even varies with API level or how your custom font defines itâ€™s line height or even how many lines your editable is rendering.</li>\n</ul>\n<p>Compose uses <code class=\"language-text\">TextStyle</code> to define a style which can then applied <code class=\"language-text\">Text</code> related composable functions</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token function\">TextStyle</span><span class=\"token punctuation\">(</span>\n    fontFamily <span class=\"token operator\">=</span> <span class=\"token function\">Font</span><span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">.</span>font<span class=\"token punctuation\">.</span>maison_neue_book<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toFontFamily</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    fontSize <span class=\"token operator\">=</span> <span class=\"token number\">12</span><span class=\"token punctuation\">.</span>sp<span class=\"token punctuation\">,</span>\n    lineHeight <span class=\"token operator\">=</span> <span class=\"token number\">16</span><span class=\"token punctuation\">.</span>sp<span class=\"token punctuation\">,</span>\n    color <span class=\"token operator\">=</span> <span class=\"token function\">Color</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xFFFF323D</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">TextStyle</code> supports a variety of properties <code class=\"language-text\">fontSynthesis</code>, <code class=\"language-text\">letterSpacing</code>, <code class=\"language-text\">baselineShift</code> etc. I wasnâ€™t even aware such things were possible until I looked at these classesðŸ˜…</p>\n<p><code class=\"language-text\">Spannable</code> is now known as <code class=\"language-text\">AnnotatedString</code> which accepts <code class=\"language-text\">SpanStyle</code> and <code class=\"language-text\">ParagraphStyles</code>.</p>\n<p>The larger improvement here is <code class=\"language-text\">Text</code> is text, itâ€™s no longer a base class for <code class=\"language-text\">Button</code>, <code class=\"language-text\">EditText</code> (Composition over inheritance). Editable and Clickable behaviours are represented with different composables functions or Modifiers. </p>\n<h2 id=\"spacings-shapes-and-shadows\" style=\"position:relative;\"><a href=\"#spacings-shapes-and-shadows\" aria-label=\"spacings shapes and shadows permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spacings, Shapes and Shadows</h2>\n<p><strong>Spacings</strong></p>\n<p>Compose introduces two new classes <code class=\"language-text\">androidx.compose.ui.unit.Dp</code> and <code class=\"language-text\">androidx.compose.ui.unit.Px</code> to define measurements. Spacings can be mapped using plain objects or classes depending whether they are theme dependent or not.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">object</span> Spacing <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> spacingX <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">.</span>dp\n    <span class=\"token operator\">..</span><span class=\"token operator\">..</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Shapes</strong></p>\n<p>Compose has its own <code class=\"language-text\">Shape</code> interface which can be used to define custom shapes. Concrete implementations are available such as <code class=\"language-text\">CircleShape</code>, <code class=\"language-text\">RoundedCornerShape</code>, <code class=\"language-text\">CutCornerShape</code> etc.</p>\n<p><strong>Shadows</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\">Modifier<span class=\"token punctuation\">.</span><span class=\"token function\">shadow</span><span class=\"token punctuation\">(</span>elevation <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">.</span>dp<span class=\"token punctuation\">,</span> shape <span class=\"token operator\">=</span> <span class=\"token function\">RoundedCornerShape</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">.</span>dp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Since Compose uses Androidâ€™s canvas to draw shadow, support for colored shadows is not possible. Fake colored shadows can be drawn on canvas using <code class=\"language-text\">Canvas</code> composable.</p>\n<h2 id=\"theming-and-compositionlocal\" style=\"position:relative;\"><a href=\"#theming-and-compositionlocal\" aria-label=\"theming and compositionlocal permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Theming and CompositionLocal</h2>\n<p>Traditionally Androidâ€™s theming system is heavily dependent on XML. We would usually have a style file called <code class=\"language-text\">AppTheme</code> which is applied at an application or activity level and it would define all attributes such as colors which are used by layouts in XML.</p>\n<p>The Android framework takes care of loading styles from <code class=\"language-text\">AndroidManifest.xml</code> and the loaded theme is stored inside the currently applicable <code class=\"language-text\">Context</code>. A simple example is when using light/dark theme you would traditionally use <code class=\"language-text\">activity.setTheme</code> and after that all layouts inflated can automatically query attributes which were defined in the theme.</p>\n<p>Compose doesnâ€™t follow such a mechanism because all properties around colors, typography and spacings are defined in Kotlin classes and not linked to <code class=\"language-text\">Context</code>.</p>\n<p>Enter <code class=\"language-text\">CompositionLocal</code> (also known as Ambients previously).</p>\n<p><code class=\"language-text\">CompositionLocal</code> in a simple definition, is a Service locator which can be used to store and retrieve arbitrary values. But they come with goodies, when values inside these locals change Compose will trigger UI update(think dynamic theming without activity restart).\nSince they are kind of Service Locators, itâ€™s easy to shoot yourself in the foot with them due to lack of compile time checks. However they are extremely useful to define and store theme related data.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">internal</span> <span class=\"token keyword\">val</span> LocalTypography <span class=\"token operator\">=</span> staticCompositionLocalOf <span class=\"token punctuation\">{</span> <span class=\"token function\">greenThemeLightTypography</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">internal</span> <span class=\"token keyword\">val</span> LocalColors <span class=\"token operator\">=</span> staticCompositionLocalOf <span class=\"token punctuation\">{</span> <span class=\"token function\">greenThemeLightColors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">internal</span> <span class=\"token keyword\">val</span> LocalSpacing <span class=\"token operator\">=</span> staticCompositionLocalOf <span class=\"token punctuation\">{</span> <span class=\"token function\">greenThemeLightSpacing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">CompositionLocal</code> can be created using <code class=\"language-text\">staticCompositionLocalOf</code> or <code class=\"language-text\">compositionLocalOf</code>. The former should be used when you expect values inside them to be changed less often, which is true for themes since you might not expect themes to change very often(day/night).</p>\n<p>Once we have a way to retrieve properties from locals, we can wrap them into a top level composable which would intialise these locals and its children would be our UI content.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token function\">AlohaTheme</span><span class=\"token punctuation\">(</span>\n    currentTheme<span class=\"token operator\">:</span> AlohaThemeToken <span class=\"token operator\">=</span> AlohaThemeToken<span class=\"token punctuation\">.</span>GREEN_THEME_LIGHT<span class=\"token punctuation\">,</span>\n    content<span class=\"token operator\">:</span> <span class=\"token annotation builtin\">@Composable</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Unit\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> <span class=\"token punctuation\">(</span>alohaTypography<span class=\"token punctuation\">,</span> alohaColors<span class=\"token punctuation\">,</span> alohaSpacing<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">when</span> <span class=\"token punctuation\">(</span>currentTheme<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/*Logic to return types according to theme*/</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">CompositionLocalProviders</span><span class=\"token punctuation\">(</span>\n        LocalTypography provides alohaTypography<span class=\"token punctuation\">,</span>\n        LocalColors provides alohaColors<span class=\"token punctuation\">,</span>\n        LocalSpacing provides alohaSpacing\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n        <span class=\"token function\">content</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> \n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Expose types</span>\n<span class=\"token keyword\">val</span> AlohaColors \n    <span class=\"token annotation builtin\">@Composable</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> LocalColors<span class=\"token punctuation\">.</span>current\n\n<span class=\"token comment\">// Application UI</span>\nsetContent <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> currentTheme <span class=\"token operator\">=</span> remember <span class=\"token punctuation\">{</span> <span class=\"token function\">mutableStateOf</span><span class=\"token punctuation\">(</span>AlohaThemeToken<span class=\"token punctuation\">.</span>GREEN_THEME_LIGHT<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">AlohaTheme</span><span class=\"token punctuation\">(</span>currentTheme <span class=\"token operator\">=</span> currentTheme<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// UI which can access colors using AlohaColors,</span>\n        <span class=\"token comment\">// typography using AlohaTypography</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">CompositionLocalProviders</code> allows us to set values to <code class=\"language-text\">CompositionLocals</code>. Since our theme properties like <code class=\"language-text\">Typography</code>, <code class=\"language-text\">Color</code> and <code class=\"language-text\">Spacing</code> can change according to theme we use <code class=\"language-text\">provides</code> to bind values to <code class=\"language-text\">LocalTypography</code>, <code class=\"language-text\">LocalColors</code> and <code class=\"language-text\">LocalSpacing</code>. So if a composable requests current colors using <code class=\"language-text\">LocalColors.current</code>, it will receive color according to theme.</p>\n<h2 id=\"components\" style=\"position:relative;\"><a href=\"#components\" aria-label=\"components permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Components</h2>\n<p>If we take a look back at traditional Android UI, the framework provided a lot of customisable components such as <code class=\"language-text\">Button</code>, <code class=\"language-text\">EditText</code> and even more like <code class=\"language-text\">RecyclerView</code>, <code class=\"language-text\">Card</code> were provided via AppCompat. One of the behaviour common in a lot of these components was they were themed according to what theme OS was applying. For example a <code class=\"language-text\">Button</code> would look wildly different depending on which OS it was being rendered. For <code class=\"language-text\">MaterialTheme</code>, this was advently solved by MDC components which followed material guidelines irrespective of OS versions on which they were being rendered.</p>\n<p>Compose builds components on the same concept where components are separated by a design layer defined by <code class=\"language-text\">foundation</code> and <code class=\"language-text\">material</code> packages.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/919b58cee0efdda9d1cc2015126250e3/7a4b2/ui-packages.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.916666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAACxLAAAsSwGlPZapAAAAkklEQVQY06WQawuCQBBFd61co0LshSY9TEz7/3/QO3E+LJEgNHBgd2Zn58517ncsxF30YhAVJO6POIlG1OIqirmNS7EWmdiIVASxE543K+6Bd4GeyQ9NQcuKtuolqvvo/BYP6rcpC85MM3UHFFou//p0z9mUlljgseaI75/YYnzN5A4leaQgI1cx9MVGDfcnWyYj/0cFehvmcQ4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/919b58cee0efdda9d1cc2015126250e3/8ac56/ui-packages.webp 240w,\n/static/919b58cee0efdda9d1cc2015126250e3/d3be9/ui-packages.webp 480w,\n/static/919b58cee0efdda9d1cc2015126250e3/e46b2/ui-packages.webp 960w,\n/static/919b58cee0efdda9d1cc2015126250e3/9eb34/ui-packages.webp 1240w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/919b58cee0efdda9d1cc2015126250e3/8ff5a/ui-packages.png 240w,\n/static/919b58cee0efdda9d1cc2015126250e3/e85cb/ui-packages.png 480w,\n/static/919b58cee0efdda9d1cc2015126250e3/d9199/ui-packages.png 960w,\n/static/919b58cee0efdda9d1cc2015126250e3/7a4b2/ui-packages.png 1240w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/919b58cee0efdda9d1cc2015126250e3/d9199/ui-packages.png\"\n            alt=\"ui packages\"\n            title=\"ui packages\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>UI components within the Compose framework are divided into classes which make no assumptions around Theming such as <code class=\"language-text\">BasicText</code> and classes such as <code class=\"language-text\">Text</code> which expose <code class=\"language-text\">LocalTextStyle</code> as a <code class=\"language-text\">CompositionLocal</code> allowing them to be themed. This can be compared to color attributes such as <code class=\"language-text\">colorControlActivated</code> which we would use in traditional framework components such as <code class=\"language-text\">Switch</code> to theme it.</p>\n<p><strong>To Material or not</strong></p>\n<p>Since compose separates out Material components, if you try to build a Custom Design system with just <code class=\"language-text\">foundation</code>, the only components you will find yourself with are <code class=\"language-text\">BasicText</code>, <code class=\"language-text\">BasicTextField</code> and layout functions. Any other component like <code class=\"language-text\">RadioButton</code>, <code class=\"language-text\">CheckBox</code>, <code class=\"language-text\">Switch</code> etc will have to be built with scratch which is a departure from current situation where you could create custom versions of such components using <code class=\"language-text\">AppCompatRadioButton</code>, <code class=\"language-text\">AppCompatCheckBox</code>, <code class=\"language-text\">SwitchCompat</code> etc.</p>\n<p>While this might look like a hiccup, it presents a larger question to creators of Custom Design System - whether you should accept Material behaviour inside your Design System. You can always <em>compose</em> a new Design System on top of <code class=\"language-text\">MaterialTheme</code> composable which would then allow you to create custom components as well as use existing Material ones. <a href=\"https://github.com/android/compose-samples/blob/main/Jetsnack/app/src/main/java/com/example/jetsnack/ui/theme/Theme.kt#L81\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hereâ€™s an example in Jetsnack sample</a></p>\n<p>Material components use <code class=\"language-text\">CompositionLocal</code> heavily to define elevations, content colors as well as Interaction states are defined when <code class=\"language-text\">MaterialTheme</code> composable is initialised. While most of these properties and behaviours can be overridden, it must be understood these components have a default behaviour which is based on Material guidelines. If you have a Design System which defines custom interactions apart from colors and typographies, this is something which you should keep in mind if you <em>compose</em> your design system on top of Materialâ€™s implementation.</p>\n<h2 id=\"backward-compatibility-and-migration\" style=\"position:relative;\"><a href=\"#backward-compatibility-and-migration\" aria-label=\"backward compatibility and migration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Backward Compatibility and Migration</h2>\n<p>While Compose is definitely an exciting new way to build UI, our existing traditional views are not going anywhere(probably for years!). Hence we must find a way to reuse existing styles and components wherever needed.</p>\n<p><strong>Theme</strong></p>\n<p>Material has an excellent example for keeping themes backward compatible using an <a href=\"https://github.com/material-components/material-components-android-compose-theme-adapter\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">adapter</a>. This allows you to keep xml styles as source of truth and very useful if the UI screen is mix and match of both Traditional views and Compose UI Components.</p>\n<p><strong>Components</strong></p>\n<p>Existing view components can be converted to Composables using <code class=\"language-text\">AndroidView</code> composable.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Composable</span>\n<span class=\"token keyword\">fun</span> <span class=\"token function\">AlohaCheckBox</span><span class=\"token punctuation\">(</span>\n    isChecked<span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">,</span>\n    isEnabled<span class=\"token operator\">:</span> Boolean <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    onChecked<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>checked<span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Unit\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">AndroidView</span><span class=\"token punctuation\">(</span>factory <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> context <span class=\"token operator\">-></span>\n        <span class=\"token keyword\">val</span> alohaCheckBox <span class=\"token operator\">=</span> <span class=\"token function\">AlohaCheckBox</span><span class=\"token punctuation\">(</span>context <span class=\"token operator\">=</span> context<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Traditional UI view themed via style applied at activity/fragment level</span>\n        alohaCheckBox<span class=\"token punctuation\">.</span>isChecked <span class=\"token operator\">=</span> isChecked\n        alohaCheckBox<span class=\"token punctuation\">.</span>isEnabled <span class=\"token operator\">=</span> isEnabled\n        alohaCheckBox<span class=\"token punctuation\">.</span><span class=\"token function\">setOnCheckedChangeListener</span> <span class=\"token punctuation\">{</span> _<span class=\"token punctuation\">,</span> checked <span class=\"token operator\">-></span> onChecked<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>checked<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span><span class=\"token label symbol\">@AndroidView</span> alohaCheckBox\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This provides a clear migration path for components since you can start off with re-writing components which can take advantage of Composeâ€™s state management system and retrofit other components using <code class=\"language-text\">AndroidView</code> to be migrated later. <code class=\"language-text\">AndroidView</code> wrapped components can still define their APIs using a <code class=\"language-text\">@Composable</code> function whereas their underlying implementation can change later.</p>\n<h2 id=\"final-thoughts\" style=\"position:relative;\"><a href=\"#final-thoughts\" aria-label=\"final thoughts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Final Thoughts</h2>\n<p>I had a lot of fun migrating our Design System to Compose. It definitely solves a lot of problems around abstractions and dynamic theming which plague the current theming system in Android. Composeâ€™s modern nature is complemented by the fact that itâ€™s APIs are named in such a manner, if youâ€™ve used React, Bootstrap etc you might feel at home with concepts like <code class=\"language-text\">Alignment</code>, <code class=\"language-text\">Arrangement</code> etc and state management. There might remain a lot of unanswered questions as developers implement this framework in their apps but overall the experience should be refreshing!</p>","fields":{"slug":"/posts/composing-a-design-system/","tagSlugs":["/tag/android/"]},"frontmatter":{"date":"2021-02-25","description":"Building a custom Design System with Jetpack Compose","tags":["Android"],"title":"Composing a Design System","banner":"media/composing-a-design-system/banner.png"}}},"pageContext":{"slug":"/posts/composing-a-design-system/"}},"staticQueryHashes":["1122560877","251939775","401334301"]}