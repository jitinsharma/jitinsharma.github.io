{"componentChunkName":"component---src-templates-post-template-tsx","path":"/posts/compute-and-ai-with-kotlin-on-cloudflare-workers/","result":{"data":{"markdownRemark":{"id":"4636007f-c016-5999-8e22-f1074708b56c","html":"<p>What if your serverless functions and mobile apps could share the same code — models, network logic, and business rules — all in one place?\nAt work, we’ve been using Cloudflare Workers for a while, and I recently decided to try building them in Kotlin using Kotlin Multiplatform. The result: a unified codebase powering both our edge functions and mobile applications, with no duplicated logic.</p>\n<h2 id=\"workers-and-edge-computing\" style=\"position:relative;\"><a href=\"#workers-and-edge-computing\" aria-label=\"workers and edge computing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Workers and Edge Computing</h2>\n<p>Cloudflare Workers allow you to run serverless functions across a globally distributed network, choosing the location closest to the user (possibly even in their city).\nInstead of routing everything to a single server in one location, your functions run where they’re needed, reducing latency and improving performance.</p>\n<p>Workers also provide built-in integrations such as:</p>\n<ul>\n<li>Key-Value storage</li>\n<li>Databases</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3dcbeffe57b612bd20c37a9685654ecc/8d68c/edge.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABtUlEQVR42pVT2XaCQAz1Z6oIyM6wyCII0ta1Paf//ylpbgYo9ql9iMxkuUnuXFeGHZLpJuTFNflLUzX7KrL9jDYW5ziK3KgUP+KI/eTVtAv2ZNgRrZCMS9Fe6NA/qO5u8m2GDyqasyRvrIBsL6O0epUYrDxeOfdOFedXfA7TVgPiB91RYHmpTASTM3w8vcFNt7tYfJarzfbzMZ6KH1vOgDBMCjPsmIvV4q7jaIpi00kkbrnZeFdzE9QKoMc8ZPUbpeVA+eGdcj5nvB4sSBqZzg0LitJO1quON+rPX7z6XdZWeS8rY0oNyDxNQL8tTDWgA8DsSDEXJ8VA7fDJvJ8p3vfs7zSgkyxWNgNt1kRBQGvzeWVwhiJMIl9HcyeccgyNBRAHeYiRbLw6CjSAmjk25GFyiSFn4tTk78S3yEYkwfyJJE4PkULDK4FXrAqtSh43ha85saTaq0gLuaACzZ5k44blLFRYoA7ksZAhCb12KNO4UcUxLWzkIHcS9Qw4jfuy9XWAu03npXSm+9oMnmyZMz8KXrrkf0vRXKhmOUAaeLntuMpfbQZ0eOWYnz9iEJV3YmjyX8Bv5Q6iSHhjoa8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3dcbeffe57b612bd20c37a9685654ecc/8ac56/edge.webp 240w,\n/static/3dcbeffe57b612bd20c37a9685654ecc/d3be9/edge.webp 480w,\n/static/3dcbeffe57b612bd20c37a9685654ecc/e46b2/edge.webp 960w,\n/static/3dcbeffe57b612bd20c37a9685654ecc/5dcdf/edge.webp 1234w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3dcbeffe57b612bd20c37a9685654ecc/8ff5a/edge.png 240w,\n/static/3dcbeffe57b612bd20c37a9685654ecc/e85cb/edge.png 480w,\n/static/3dcbeffe57b612bd20c37a9685654ecc/d9199/edge.png 960w,\n/static/3dcbeffe57b612bd20c37a9685654ecc/8d68c/edge.png 1234w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3dcbeffe57b612bd20c37a9685654ecc/d9199/edge.png\"\n            alt=\"edge\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"workers-runtime\" style=\"position:relative;\"><a href=\"#workers-runtime\" aria-label=\"workers runtime permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Workers Runtime</h2>\n<p>Workers run on WebAssembly (WASM), a portable and high-performance binary format that can be compiled from various languages.</p>\n<p>This opens the door for Kotlin/JS — Kotlin code compiled to JavaScript (and eventually running inside WASM).\nWe get to keep Kotlin’s strong type system, coroutines, and familiar APIs, while targeting the Cloudflare Workers runtime.</p>\n<p>Example Worker entrypoint in Kotlin:</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@JsExport</span>\n<span class=\"token keyword\">fun</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>request<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> env<span class=\"token operator\">:</span> <span class=\"token keyword\">dynamic</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> ctx<span class=\"token operator\">:</span> <span class=\"token keyword\">dynamic</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">dynamic</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> GlobalScope<span class=\"token punctuation\">.</span><span class=\"token function\">promise</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"sharing-code-with-kmp\" style=\"position:relative;\"><a href=\"#sharing-code-with-kmp\" aria-label=\"sharing code with kmp permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sharing code with KMP</h2>\n<p>Because the whole setup uses Kotlin, we can share a significant amount of code between mobile and edge environments, including:</p>\n<ul>\n<li>HTTP client (ktor)</li>\n<li>Serialization (kotlinx.serialization)</li>\n<li>Request/Response models</li>\n<li>Business rules and validation logic</li>\n</ul>\n<p>This means the same Kotlin models that your Android/iOS app uses can also be used in your Workers, ensuring consistency and\neliminating duplication.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e5bef1b96ba54bd54e3b694a29829017/bb543/kmp.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.08333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACEElEQVR42pWSW08TURSF59cIMr0w086UduyFVgIqVrG+eAmaaIwJAgGVopYplCKFUii9UTSUS8tNIhEJhPho4u9anr3HRqOS6MPKZPac+c5eey+p1ebG/6jNoePZSAKpTAmvklmMm/N4PbXA7/2PhiDRoRZZxYU2Sy2y61wYfSPgWv0TZrJVRGP9uPtwAL1990XtCLO5VUgX7RpUPQS3NywUQbs7AKrRj39CNcjODhRWt5FfaWDoxSReJjIYHDWxvnMMM523gJovAm+gh6V6Qgy0KV4L+qNjqjUvKgpgbfszcqUNAa4jW6hh5+MXmNNLBNSFFcuOZVdjANknAHXUyiAPS3Z6UFn7gKfDb6AbXYj03BINXUZ6voJpMUdJEXb94eusQCQKo/MaHK5LDHK4/DBCvVwPdt3gkVB9udrA4clXbO6donFwhq39UxydfUMitQiJDtgVH2ztHZCF7KqPbfECRDdOtx8O1eCnjc95sVjexJOBOC/l9p3HuHrzHuITc5iaLUKiH+mQogdZBCHLVGuCKQXNUVCNlpKaK2PwuYnR8bSI0QSWyluYfFuwYkO3+4JXWHbFAM3VKWzTDH/fMjmgeBTf7bL15arYeKWOldqB6DJjAZsZ+zWDf8sjLUrRAhgTUens7hMLiSEslkLzjcYeYCSe+gn8F9EltOXkTJ67WyisI1fc4NiU3u+KXCbxHUXTo5dBA8hNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e5bef1b96ba54bd54e3b694a29829017/8ac56/kmp.webp 240w,\n/static/e5bef1b96ba54bd54e3b694a29829017/d3be9/kmp.webp 480w,\n/static/e5bef1b96ba54bd54e3b694a29829017/e46b2/kmp.webp 960w,\n/static/e5bef1b96ba54bd54e3b694a29829017/e0593/kmp.webp 1418w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e5bef1b96ba54bd54e3b694a29829017/8ff5a/kmp.png 240w,\n/static/e5bef1b96ba54bd54e3b694a29829017/e85cb/kmp.png 480w,\n/static/e5bef1b96ba54bd54e3b694a29829017/d9199/kmp.png 960w,\n/static/e5bef1b96ba54bd54e3b694a29829017/bb543/kmp.png 1418w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e5bef1b96ba54bd54e3b694a29829017/d9199/kmp.png\"\n            alt=\"kmp\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"inferencing-ai-models-at-edge\" style=\"position:relative;\"><a href=\"#inferencing-ai-models-at-edge\" aria-label=\"inferencing ai models at edge permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Inferencing AI models at edge</h2>\n<p>Cloudflare’s AI Workers integration takes edge computing further by allowing AI inference directly at the edge.\nImagine parsing a request, running an LLM, and returning a result — all without leaving the nearest Cloudflare PoP.</p>\n<p>Here’s an example of calling an AI model from Kotlin:</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">handleAIRequest</span><span class=\"token punctuation\">(</span>env<span class=\"token operator\">:</span> <span class=\"token keyword\">dynamic</span><span class=\"token punctuation\">,</span> request<span class=\"token operator\">:</span> AIRequest<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Response <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> prompt <span class=\"token operator\">=</span> <span class=\"token string-literal multiline\"><span class=\"token string\">\"\"\"\n        Provide one paragraph information about </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">request<span class=\"token punctuation\">.</span>url</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n        Response should only contain text and should give brief about conference\n        topics, speakers and location.\n    \"\"\"</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">trimIndent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">val</span> aiResponse <span class=\"token operator\">=</span> env<span class=\"token punctuation\">.</span>ai<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"@cf/meta/llama-3-8b-instruct\"</span></span><span class=\"token punctuation\">,</span> promptObject<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span>unsafeCast<span class=\"token operator\">&lt;</span>kotlin<span class=\"token punctuation\">.</span>js<span class=\"token punctuation\">.</span>Promise<span class=\"token operator\">&lt;</span><span class=\"token keyword\">dynamic</span><span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">await</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">return</span> <span class=\"token function\">Response</span><span class=\"token punctuation\">(</span>Json<span class=\"token punctuation\">.</span><span class=\"token function\">encodeToString</span><span class=\"token punctuation\">(</span>aiResponse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">ResponseInit</span><span class=\"token punctuation\">(</span>headers <span class=\"token operator\">=</span> headers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The same code handles HTTP parsing, AI model execution, and response formatting — all at the edge, with minimal latency.</p>\n<h2 id=\"tradeoffs\" style=\"position:relative;\"><a href=\"#tradeoffs\" aria-label=\"tradeoffs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tradeoffs</h2>\n<p>While Kotlin/JS works well with JavaScript, there are considerations:</p>\n<ul>\n<li>ES module export — Workers require ESM; setup can be tricky.</li>\n<li>Bundle size — Kotlin/JS output may be larger than handwritten JS.</li>\n</ul>\n<p>That said, if your team already uses Kotlin Multiplatform, this approach delivers huge code reuse and consistency wins.</p>\n<p><em>The complete source code and detailed setup instructions are available in my <a href=\"https://github.com/jitinsharma/kotlinworker\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">KotlinWorker repository</a></em></p>","fields":{"slug":"/posts/2025-09-08---compute-and-ai-with-kotlin-on-cloudflare-workers//posts/compute-and-ai-with-kotlin-on-cloudflare-workers/","tagSlugs":["/tag/kotlin/","/tag/serverless/"]},"frontmatter":{"date":"2025-08-09","tags":["Kotlin","Serverless"],"title":"Compute and AI with Kotlin on Cloudflare Workers","description":"Building serverless edge functions with Kotlin/JS and sharing code across mobile and serverless platforms","slug":"/posts/compute-and-ai-with-kotlin-on-cloudflare-workers/","socialImage":null}}},"pageContext":{"slug":"/posts/2025-09-08---compute-and-ai-with-kotlin-on-cloudflare-workers//posts/compute-and-ai-with-kotlin-on-cloudflare-workers/"}},"staticQueryHashes":["4208939363"],"slicesMap":{}}