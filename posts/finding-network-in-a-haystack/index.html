<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.14.1"/><meta name="theme-color" content="hsl(31, 92%, 62%)"/><meta name="description" content="Low-level discoveries for improving network reliability and performance in mobile apps" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta name="twitter:title" content="Finding Network in a haystack - Jitin Sharma" data-gatsby-head="true"/><meta name="twitter:description" content="Low-level discoveries for improving network reliability and performance in mobile apps" data-gatsby-head="true"/><meta name="og:title" content="Finding Network in a haystack - Jitin Sharma" data-gatsby-head="true"/><meta name="og:type" content="website" data-gatsby-head="true"/><meta name="og:description" content="Low-level discoveries for improving network reliability and performance in mobile apps" data-gatsby-head="true"/><meta name="image" content="https://jitinsharma.com/static/7a2a680950d73850a7efee9dd690337a/image.png" data-gatsby-head="true"/><meta name="og:image" content="https://jitinsharma.com/static/7a2a680950d73850a7efee9dd690337a/image.png" data-gatsby-head="true"/><meta name="twitter:image" content="https://jitinsharma.com/static/7a2a680950d73850a7efee9dd690337a/image.png" data-gatsby-head="true"/><style data-href="/styles.fa2e22f4063c800b4b4b.css" data-identity="gatsby-global-css">html{font-size:100}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;background:hsl(var(--color-background));color:hsl(var(--color-foreground));font-size:16px;line-height:1.625;margin:0 0 0 calc(100vw - 100%);text-rendering:optimizelegibility}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:40px;line-height:52px;margin-bottom:26px;margin-top:104px}h2{font-size:27px;line-height:39px}h2,h3{margin-bottom:13px;margin-top:52px}h3{font-size:22px;line-height:26px}h4{font-size:19.2px;margin-top:39px}h4,h5{line-height:26px;margin-bottom:13px}h5,h6{font-size:16px;margin-top:65px}h6{line-height:26px;margin-bottom:13px}img{max-width:100%}hr,img{border:0;display:block}hr{background-image:linear-gradient(to bottom,transparent 1px,transparent 11px,hsl(var(--color-foreground)) 11px,hsl(var(--color-foreground)) 15px,transparent 15px,transparent 26px);background-size:100% 26px;height:26px;margin:52px auto;width:100px}a,hr{color:hsl(var(--color-foreground))}a{text-decoration:none}a:active,a:focus,a:hover{color:hsl(var(--color-primary))}b,strong{font-weight:600}ul{list-style:square;margin-bottom:26px}ul li{margin-bottom:10px;padding:0 5px}p{line-height:26px;margin-bottom:26px}blockquote{font-style:italic;padding:0;text-align:center}figure{display:block;height:auto;width:100%}figcaption{color:hsl(var(--color-foreground));font-size:14px;font-style:italic;line-height:19.5px;margin-bottom:0;margin-top:6.5px;text-align:center}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:310px;padding:0 26px}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{word-wrap:normal;color:#657b83;font-family:ui-monospace,Cascadia Code,Source Code Pro,Menlo,Consolas,DejaVu Sans Mono,monospace;font-size:16px;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:hsl(var(--color-muted))}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#073642}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{background:#eee8d5;color:#657b83;cursor:help}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}:root{--color-background:0 0% 100%;--color-foreground:240 7% 11%;--color-muted:240 6% 96%;--color-muted-foreground:240 6% 46.1%;--color-border:240 2% 89%;--color-primary:342 100% 47%;--color-primary-foreground:240 4% 98%;--color-secondary:240 6% 96%;--color-secondary-foreground:240 2% 17%;--color-accent:240 6% 96%;--color-accent-foreground:240 2% 17%;--color-destructive:342 100% 47%;--color-destructive-foreground:240 7% 11%;--color-positive:162 52% 53%;--color-positive-foreground:240 7% 11%;color-scheme:light}.dark{--color-background:240 7% 11%;--color-foreground:240 4% 98%;--color-muted:240 4% 17%;--color-muted-foreground:240 4% 66%;--color-border:240 4% 17%;--color-primary:342 100% 74%;--color-primary-foreground:240 4% 98%;--color-secondary:240 4% 17%;--color-secondary-foreground:240 4% 98%;--color-accent:240 4% 17%;--color-accent-foreground:240 4% 98%;--color-destructive:342 100% 74%;--color-destructive-foreground:240 7% 11%;--color-positive:162 52% 53%;--color-positive-foreground:240 7% 11%;color-scheme:dark}.feed-module--feed--be542 .feed-module--item--093ea{margin-bottom:32.5px}.feed-module--feed--be542 .feed-module--item--093ea:last-child{margin-bottom:13px}.feed-module--feed--be542 .feed-module--item--093ea .feed-module--title--6ed13{font-size:27px;line-height:39px;margin-bottom:13px;margin-top:0}.feed-module--feed--be542 .feed-module--item--093ea .feed-module--title--6ed13 .feed-module--link--797ef{color:hsl(var(--color-foreground))}.feed-module--feed--be542 .feed-module--item--093ea .feed-module--title--6ed13 .feed-module--link--797ef:focus,.feed-module--feed--be542 .feed-module--item--093ea .feed-module--title--6ed13 .feed-module--link--797ef:hover{border-bottom:1px solid hsl(var(--color-foreground));color:hsl(var(--color-foreground))}.feed-module--feed--be542 .feed-module--item--093ea .feed-module--description--25c4d{color:hsl(var(--color-muted-foreground));font-size:16px;line-height:26px;margin-bottom:19.5px}.feed-module--feed--be542 .feed-module--item--093ea .feed-module--meta--5bd77 .feed-module--time--1da0e{color:hsl(var(--color-foreground));font-size:14px;font-weight:600;text-transform:uppercase}.feed-module--feed--be542 .feed-module--item--093ea .feed-module--meta--5bd77 .feed-module--divider--dc8bf{margin:0 13px}.feed-module--feed--be542 .feed-module--item--093ea .feed-module--meta--5bd77 .feed-module--category--588f4 .feed-module--link--797ef{color:hsl(var(--color-primary));font-size:14px;font-weight:600;text-transform:uppercase}.feed-module--feed--be542 .feed-module--item--093ea .feed-module--more--9d839{color:hsl(var(--color-foreground));font-size:16px}.feed-module--feed--be542 .feed-module--item--093ea .feed-module--more--9d839:focus,.feed-module--feed--be542 .feed-module--item--093ea .feed-module--more--9d839:hover{border-bottom:1px solid hsl(var(--color-primary));color:hsl(var(--color-primary))}.page-module--page--aeaf7{grid-column:span 12;margin-bottom:52px}.page-module--page--aeaf7 .page-module--inner--bbb89{padding:26px 19.5px 0}.page-module--page--aeaf7 .page-module--title--3f843{font-size:40px;font-weight:600;line-height:52px;margin-bottom:37.7px;margin-top:0}.page-module--page--aeaf7 .page-module--body--91ea2{font-size:16px;line-height:26px;margin:0 0 26px}.page-module--page--aeaf7 .page-module--body--91ea2 p a{text-decoration:underline}@media screen and (min-width:685px){.page-module--page--aeaf7{grid-column:span 7}.page-module--page--aeaf7 .page-module--inner--bbb89{padding:32.5px 19.5px 0}}@media screen and (min-width:1100px){.page-module--page--aeaf7{grid-column:span 8}.page-module--page--aeaf7 .page-module--inner--bbb89{padding:39px 26px 0}}.button-module--button--5ffa9{border:1px solid hsl(var(--color-border));border-radius:20px;color:hsl(var(--color-foreground));display:inline-block;font-size:16px;font-weight:400;height:40px;line-height:40px;margin-left:auto;margin-right:auto;padding:0 26px;text-align:center;text-decoration:none}.button-module--button--5ffa9:focus,.button-module--button--5ffa9:hover{background:hsl(var(--color-accent));color:hsl(var(--color-accent-foreground))}.post-tags-module--post-tags--6c235{list-style:none;margin-bottom:13px;padding:0}.post-tags-module--post-tags--6c235 .post-tags-module--item--53595{display:inline-block;margin:6.5px 0}@media screen and (min-width:685px){.post-tags-module--post-tags--6c235 .post-tags-module--item--53595:first-child{margin-left:0;padding-left:0}}.post-author-module--post-author--2247e{border-top:1px solid hsl(var(--color-border));line-height:26px;margin-bottom:52px;margin-top:26px;max-width:900px;padding-top:26px}.post-author-module--post-author--2247e .post-author-module--description--78aeb .post-author-module--x--f2941{display:block;text-decoration:underline}@media screen and (min-width:685px){.post-author-module--post-author--2247e{margin-left:auto;margin-right:auto}}.post-footer-module--post-footer--9c13c .post-footer-module--date--abfe9{font-style:italic}.post-content-module--postContent--5129c{margin:0 auto;max-width:945px;padding:0 13px}.post-content-module--postContent--5129c .post-content-module--title--b7e5d{font-size:32px;font-weight:600;line-height:42.9px;margin:26px auto 0;max-width:900px;text-align:center}.post-content-module--postContent--5129c .post-content-module--body--3be78 figure{margin-bottom:26px}.post-content-module--postContent--5129c .post-content-module--body--3be78 figure blockquote{font-style:italic;margin-top:0;padding:26px 0;text-align:center}.post-content-module--postContent--5129c .post-content-module--body--3be78 figure blockquote p{font-size:26.9072px;line-height:39px;margin-bottom:26px;margin-top:0;max-width:900px}.post-content-module--postContent--5129c .post-content-module--body--3be78 a{text-decoration:underline}.post-content-module--postContent--5129c .post-content-module--body--3be78 *{margin-left:auto;margin-right:auto;max-width:900px}.post-content-module--postContent--5129c .post-content-module--body--3be78 h2>a{visibility:hidden}.post-content-module--postContent--5129c .post-content-module--body--3be78 h2>a>svg{fill:hsl(var(--color-foreground))}.post-content-module--postContent--5129c .post-content-module--body--3be78 img{max-width:100%}@media screen and (min-width:1100px){.post-content-module--postContent--5129c{padding:0}.post-content-module--postContent--5129c .post-content-module--title--b7e5d{font-size:48px;line-height:58.5px;margin-bottom:39px;margin-top:58.5px}.post-content-module--postContent--5129c .post-content-module--body--3be78,.post-content-module--postContent--5129c .post-content-module--body--3be78 p{font-size:18px;line-height:29.25px;margin-bottom:29.25px}.post-content-module--postContent--5129c .post-content-module--body--3be78 h2>a{padding-right:13px;visibility:unset}}.theme-switcher-module--themeSwitcher--8bcb4{--theme-switcher-color:hsl(var(--color-foreground))}.theme-switcher-module--themeSwitcher--8bcb4 .theme-switcher-module--button--1cdf0{align-items:center;background:transparent;border:0;cursor:pointer;display:flex;justify-content:center;outline:0}.theme-switcher-module--themeSwitcher--8bcb4 .theme-switcher-module--button--1cdf0 svg{stroke:var(--theme-switcher-color);pointer-events:none;transition:stroke .4s}.theme-switcher-module--themeSwitcher--8bcb4 .theme-switcher-module--button--1cdf0:hover{--theme-switcher-color:hsl(var(--color-primary))}.theme-switcher-module--themeSwitcher--8bcb4 .theme-switcher-module--moon--f9082{stroke-dasharray:0 1px;opacity:0;transition:stroke-dasharray .2s ease-in,opacity .4s ease-in}.theme-switcher-module--themeSwitcher--8bcb4 .theme-switcher-module--sun--65dc4{stroke-dasharray:1px 1px;opacity:1;transition:stroke-dasharray .2s ease-in,opacity .4s ease-in}.theme-switcher-module--themeSwitcher--8bcb4.theme-switcher-module--dark--fca2d .theme-switcher-module--moon--f9082{stroke-dasharray:1px 1px;opacity:1}.theme-switcher-module--themeSwitcher--8bcb4.theme-switcher-module--dark--fca2d .theme-switcher-module--sun--65dc4{stroke-dasharray:0 1px;opacity:0}.social-share-module--socialShare--2c4d2{border-top:1px solid var(--color-gray-border);margin:0 auto;max-width:900px;padding:26px 13px}.social-share-module--socialShare--2c4d2 .social-share-module--title--28c75{color:var(--color-primary);font-size:16px;font-weight:600;margin:0 0 26px}.social-share-module--socialShare--2c4d2 .social-share-module--buttons--1fc6d{align-items:center;display:flex;gap:12px}.social-share-module--socialShare--2c4d2 .social-share-module--buttons--1fc6d button{outline:none!important}.social-share-module--socialShare--2c4d2 .social-share-module--buttons--1fc6d button:hover{opacity:.8;transform:translateY(-2px);transition:all .2s ease}@media screen and (min-width:1100px){.social-share-module--socialShare--2c4d2{padding:0}}@media screen and (min-width:685px){.social-share-module--socialShare--2c4d2 .social-share-module--buttons--1fc6d{gap:10px}}.post-module--post--cd62a{grid-column:span 12}.post-module--post--cd62a .post-module--content--49372{margin:0 auto}.post-module--post--cd62a .post-module--comments--82b11,.post-module--post--cd62a .post-module--footer--87cff{margin:0 auto;max-width:900px;padding:0 13px}.post-module--post--cd62a .post-module--buttons--26059{align-items:center;display:flex;justify-content:center;margin:26px 0 0;text-align:center}.post-module--post--cd62a .post-module--buttons--26059 .post-module--buttonArticles--8a265{margin:0 13px 0 0}@media screen and (min-width:1100px){.post-module--post--cd62a .post-module--comments--82b11,.post-module--post--cd62a .post-module--footer--87cff{padding:0}.post-module--post--cd62a .post-module--buttons--26059{left:30px;margin:0 13px 0 0;max-width:none;position:fixed;top:30px}}.layout-module--layout--e08e0{display:grid;gap:30px;grid-template-columns:repeat(12,1fr);margin:0 auto;max-width:1070px}.sidebar-menu-module--sidebar-menu--a1f76{margin-bottom:26px}.sidebar-menu-module--sidebar-menu--a1f76 .sidebar-menu-module--list--11f39{list-style:none;margin:0;padding:0}.sidebar-menu-module--sidebar-menu--a1f76 .sidebar-menu-module--list--11f39 .sidebar-menu-module--item--67667{margin:13px 0;padding:0}.sidebar-menu-module--sidebar-menu--a1f76 .sidebar-menu-module--list--11f39 .sidebar-menu-module--item--67667 .sidebar-menu-module--link--b41cc{border:0;color:hsl(var(--color-foreground));font-size:16px;font-weight:400}.sidebar-menu-module--sidebar-menu--a1f76 .sidebar-menu-module--list--11f39 .sidebar-menu-module--item--67667 .sidebar-menu-module--link--b41cc:focus,.sidebar-menu-module--sidebar-menu--a1f76 .sidebar-menu-module--list--11f39 .sidebar-menu-module--item--67667 .sidebar-menu-module--link--b41cc:hover{border-bottom:1px solid hsl(var(--color-primary));color:hsl(var(--color-primary))}.sidebar-menu-module--sidebar-menu--a1f76 .sidebar-menu-module--list--11f39 .sidebar-menu-module--item--67667 .sidebar-menu-module--link--b41cc.sidebar-menu-module--active--0ae28{border-bottom:1px solid hsl(var(--color-foreground));color:hsl(var(--color-foreground))}.sidebar-author-module--sidebar-author--f2c33 .sidebar-author-module--photo--d388f{background-clip:padding-box;border:1px solid hsl(var(--color-muted));border-radius:50%;display:inline-block;height:75px;margin-bottom:0;width:75px}.sidebar-author-module--sidebar-author--f2c33 .sidebar-author-module--photo--d388f img{border-radius:50%}.sidebar-author-module--sidebar-author--f2c33 .sidebar-author-module--title--a6921{font-size:18px;font-weight:600;line-height:29.25px;margin:0}.sidebar-author-module--sidebar-author--f2c33 .sidebar-author-module--title--a6921 .sidebar-author-module--link--45332,.sidebar-author-module--sidebar-author--f2c33 .sidebar-author-module--title--a6921 .sidebar-author-module--link--45332:focus,.sidebar-author-module--sidebar-author--f2c33 .sidebar-author-module--title--a6921 .sidebar-author-module--link--45332:hover{color:hsl(var(--color-foreground))}.sidebar-author-module--sidebar-author--f2c33 .sidebar-author-module--description--05f75{color:hsl(var(--color-muted-foreground));line-height:26px;margin-bottom:26px}.sidebar-author-module--sidebar-author--f2c33 .sidebar-author-module--titleContainer--335a3{align-items:center;display:flex;justify-content:space-between;margin:13px 0}.icon-module--icon--1a7c5{fill:currentcolor;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;speak:none;stroke:currentcolor;stroke-width:0;display:inline-block;font-style:normal;font-variant:normal;font-weight:400;height:1em;line-height:1em;text-align:center;text-transform:none;width:1em}.sidebar-contacts-module--sidebar-contacts--bbb62{margin-bottom:26px}.sidebar-contacts-module--sidebar-contacts--bbb62 .sidebar-contacts-module--list--cbda4{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;margin:13px 0;max-width:165px;padding:0}.sidebar-contacts-module--sidebar-contacts--bbb62 .sidebar-contacts-module--list--cbda4 .sidebar-contacts-module--item--1f6f2{border:1px solid hsl(var(--color-muted));border-radius:50%;margin:6.5px;padding:0}.sidebar-contacts-module--sidebar-contacts--bbb62 .sidebar-contacts-module--list--cbda4 .sidebar-contacts-module--item--1f6f2:nth-child(3n+1){margin-left:0}.sidebar-contacts-module--sidebar-contacts--bbb62 .sidebar-contacts-module--list--cbda4 .sidebar-contacts-module--item--1f6f2 .sidebar-contacts-module--link--8ba2a{align-items:center;border:0;color:hsl(var(--color-foreground));cursor:pointer;display:flex;height:40px;justify-content:center;width:40px}.sidebar-contacts-module--sidebar-contacts--bbb62 .sidebar-contacts-module--list--cbda4 .sidebar-contacts-module--item--1f6f2 .sidebar-contacts-module--link--8ba2a:focus,.sidebar-contacts-module--sidebar-contacts--bbb62 .sidebar-contacts-module--list--cbda4 .sidebar-contacts-module--item--1f6f2 .sidebar-contacts-module--link--8ba2a:hover{color:hsl(var(--color-primary))}.sidebar-copyright-module--sidebar-copyright--97d08{color:hsl(var(--color-muted-foreground));font-size:14px}.sidebar-module--sidebar--58428{grid-column:span 12;width:100%}.sidebar-module--sidebar--58428 .sidebar-module--inner--f87a4{padding:26px 19.5px 0;position:relative}.sidebar-module--sidebar--58428 .sidebar-module--inner--f87a4:after{background:hsl(var(--color-border));background:linear-gradient(to bottom,hsl(var(--color-border)) 0,hsl(var(--color-border)) 48%,hsl(var(--color-background)) 100%)}@media screen and (min-width:685px){.sidebar-module--sidebar--58428{grid-column:span 5}.sidebar-module--sidebar--58428 .sidebar-module--inner--f87a4{padding:32.5px 19.5px 0}.sidebar-module--sidebar--58428 .sidebar-module--inner--f87a4:after{bottom:0;content:"";height:540px;position:absolute;right:-10px;top:30px;width:1px}}@media screen and (min-width:960px){.sidebar-module--sidebar--58428{grid-column:span 4}.sidebar-module--sidebar--58428 .sidebar-module--inner--f87a4{padding:39px}}.pagination-module--pagination--e5305{display:flex;margin-top:52px}.pagination-module--pagination--e5305 .pagination-module--previous--85cf8{text-align:left;width:50%}.pagination-module--pagination--e5305 .pagination-module--previous--85cf8 .pagination-module--previousLink--35663{color:hsl(var(--color-foreground));font-size:26px;font-weight:700}.pagination-module--pagination--e5305 .pagination-module--previous--85cf8 .pagination-module--previousLink--35663:focus,.pagination-module--pagination--e5305 .pagination-module--previous--85cf8 .pagination-module--previousLink--35663:hover{color:hsl(var(--color-primary))}.pagination-module--pagination--e5305 .pagination-module--previous--85cf8 .pagination-module--previousLink--35663.pagination-module--disable--f4637{color:hsl(var(--color-muted-foreground));pointer-events:none}.pagination-module--pagination--e5305 .pagination-module--next--92e1f{text-align:right;width:50%}.pagination-module--pagination--e5305 .pagination-module--next--92e1f .pagination-module--nextLink--9a2d7{color:hsl(var(--color-foreground));font-size:26px;font-weight:700}.pagination-module--pagination--e5305 .pagination-module--next--92e1f .pagination-module--nextLink--9a2d7:focus,.pagination-module--pagination--e5305 .pagination-module--next--92e1f .pagination-module--nextLink--9a2d7:hover{color:hsl(var(--color-primary))}.pagination-module--pagination--e5305 .pagination-module--next--92e1f .pagination-module--nextLink--9a2d7.pagination-module--disable--f4637{color:hsl(var(--color-muted-foreground));pointer-events:none}</style><link rel="alternate" type="application/rss+xml" title="Jitin Sharma" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-B3NPM3RCRE"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-B3NPM3RCRE', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=5272172f19df504b4722df79cd5148cf" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=5272172f19df504b4722df79cd5148cf"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=5272172f19df504b4722df79cd5148cf"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=5272172f19df504b4722df79cd5148cf"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=5272172f19df504b4722df79cd5148cf"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=5272172f19df504b4722df79cd5148cf"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=5272172f19df504b4722df79cd5148cf"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=5272172f19df504b4722df79cd5148cf"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=5272172f19df504b4722df79cd5148cf"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-gatsby-head="true">Finding Network in a haystack - Jitin Sharma</title></head><body><script>
          void function() {
            var cachedMode;

            try {
              var preferredTheme = JSON.parse(localStorage.getItem("diesel:theme-atom"));

              if (preferredTheme && preferredTheme.mode) {
                cachedMode = preferredTheme.mode;
              }
            } catch (err) { }

            function setTheme(newTheme) {
              document.documentElement.className = newTheme;
            }

            var darkQuery = window.matchMedia("(prefers-color-scheme: dark)");

            setTheme(cachedMode || (darkQuery.matches ? "dark" : "light"));
          }()
        </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout-module--layout--e08e0"><div class="post-module--post--cd62a"><div class="post-module--buttons--26059"><a class="button-module--button--5ffa9 post-module--buttonArticles--8a265" href="/">All Articles</a></div><div class="post-module--content--49372"><div class="post-content-module--postContent--5129c"><h1 class="post-content-module--title--b7e5d">Finding Network in a haystack</h1><div class="post-content-module--body--3be78"><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7a2a680950d73850a7efee9dd690337a/30f63/image.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 54.58333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACjUlEQVR42hXSW2/SAAAF4BpHS7m29E6hpbR0tJRCGQwYlw3YuCjIZBDAbW7CNkM2py5zTM30QafRaLwkGp+MDz4tmYm/wJj44ou/SZac15OcfDmACXaCFgSyY5CThFEGRBg1oCgBFXKydpJHOdHBCFbcY8FYGGPNTgpy4CYrOgU7JgFMFsSMkKADNyO0FWdB1NOp1Na6DSIih7rX1HaHkMKYP+xkRBvmsRNus4OGEAq0uaZgJwDTPJYqkKIuJCtKue/LNpdaw4VanZ7R9U5Xa7YJOYJ6NUqK8OWG1G8JrbKN5qCLCQRgxbnw0avC+K1WWQvMt1mjpOSb0mzVzmgYZ7Ba1h1M+1JVfeu2ut6nw8Xg4Ja3sGhx8RbcA0B2wl9uKStDxK3ifoORZ/K9Ua47kvONYL0vLvVC/S19766/vMbISVqaUTeH7FzN7CBNNhcwYYBsxHQ0l660E8VGvHAlvnB1tticHxwkDx6pve3pxoY7Upo0I7Vhor1fePE62tqR0w2cV4AJcixbDqcWSD7oVdJspMkayxifRN1hSkh51BKnV6hAnBCN+RuHq+9/Dn7/W/18vrR+yKqzgEcKxecWAZCgo73oxtPlb6PQ0Ym0ue3rbnGZqpApcUYWE3ScN/LjN+2zPysvvxd3nqRuHuK+EEBxSrK5LA6vi6MH8ceDxMO2sPsptHuinR7LvWFo/Cw+HmiD9eCdvfyHj7Wzv9XTs+TO81j/vn0CBpqR+Nfz+q8fTCxAaYKdFhxUEpfTmOR30kFEqZDxKp+PUboh5jqZe19y++8iq8feVB2agF26bGaMtJAomEDEBF9cBXaRMELBqGfyGStKWRAasjFWF+fgopic8cTKrkDCQvhNVvQ/49yE9YKI56oAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/7a2a680950d73850a7efee9dd690337a/8ac56/image.webp 240w,
/static/7a2a680950d73850a7efee9dd690337a/d3be9/image.webp 480w,
/static/7a2a680950d73850a7efee9dd690337a/e46b2/image.webp 960w,
/static/7a2a680950d73850a7efee9dd690337a/f992d/image.webp 1440w,
/static/7a2a680950d73850a7efee9dd690337a/882b9/image.webp 1920w,
/static/7a2a680950d73850a7efee9dd690337a/b0136/image.webp 2816w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/7a2a680950d73850a7efee9dd690337a/8ff5a/image.png 240w,
/static/7a2a680950d73850a7efee9dd690337a/e85cb/image.png 480w,
/static/7a2a680950d73850a7efee9dd690337a/d9199/image.png 960w,
/static/7a2a680950d73850a7efee9dd690337a/07a9c/image.png 1440w,
/static/7a2a680950d73850a7efee9dd690337a/29114/image.png 1920w,
/static/7a2a680950d73850a7efee9dd690337a/30f63/image.png 2816w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/7a2a680950d73850a7efee9dd690337a/d9199/image.png"
            alt="Finding Network in a haystack"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>I recently learned about spread spectrum technology (credit <a href="https://www.acquired.fm/" target="_blank" rel="nofollow noopener noreferrer">acquired.fm</a>) - a communication technique developed decades ago that works by hopping signals across frequencies to improve reliability. What started as a way to make military communications jam-resistant eventually led to CDMA and the cellular networks we rely on today. The entire journey of how a communication signal travels is quite fascinating, and equally complex and deep when performing a simple step such as a network call on mobile.</p>
<p>A simple HTTP request might seem straightforward, but under the hood, it’s a complex dance between your device, cellular towers, ISPs, and data centers. Each step in this chain can introduce latency, failures, or performance bottlenecks. Through real-world experimentation and production deployments, I’ve discovered several low-level optimizations that can dramatically improve network reliability and performance.</p>
<h2 id="the-network-call-journey" style="position:relative;"><a href="#the-network-call-journey" aria-label="the network call journey permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Network Call Journey</h2>
<p>Before diving into optimizations, let’s understand what actually happens when your app makes a network request:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2501bb1f9597d8370d925c7b8052872a/ba715/connection_stages.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 31.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABYklEQVR42k2QO25UQRBFZw8sgy0QsQhiMkSAxEacI1JSZ4iAAAIkBBphyUi2BR7Pf/w+/bq7+vfezNiyDuUBAUGrSt23Tt3bo0ndMp5OmbWGPOzp0pbK99Qy4PNA7LfYWPCpJ2lfW8faeBpJuBAIuRDK9u8ZPXl1xIOXT3n+5jWiossm8eXS8m0uLG3BSuR8suJq1eBjZFI5xjPhZB659plUElJ2/4Bn6w0fL874UVXEsld3masqsmgTrfRI3mFDwcX+4KYLibXNLNt4cB1yUtB/wH57y83+jmF3S2s7jFdhcIi6Md7jxGns/e+hfA/I1Lp00wW91y8p+fAm+Q9QVOT7O8ScUr9/SPh5hPn0GDl9QTt+RvXhESl7jXVD7gszExlr3JNlYqV95y3XCv9+MaUywiiUgXDvIFpkcYx05/jlO6T+itt8xi7e6ub+4CJqbUSYNcJch40ETRNwGr22WmPhFxgKuxKqjmwIAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/2501bb1f9597d8370d925c7b8052872a/8ac56/connection_stages.webp 240w,
/static/2501bb1f9597d8370d925c7b8052872a/d3be9/connection_stages.webp 480w,
/static/2501bb1f9597d8370d925c7b8052872a/e46b2/connection_stages.webp 960w,
/static/2501bb1f9597d8370d925c7b8052872a/f992d/connection_stages.webp 1440w,
/static/2501bb1f9597d8370d925c7b8052872a/882b9/connection_stages.webp 1920w,
/static/2501bb1f9597d8370d925c7b8052872a/2b738/connection_stages.webp 2210w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/2501bb1f9597d8370d925c7b8052872a/8ff5a/connection_stages.png 240w,
/static/2501bb1f9597d8370d925c7b8052872a/e85cb/connection_stages.png 480w,
/static/2501bb1f9597d8370d925c7b8052872a/d9199/connection_stages.png 960w,
/static/2501bb1f9597d8370d925c7b8052872a/07a9c/connection_stages.png 1440w,
/static/2501bb1f9597d8370d925c7b8052872a/29114/connection_stages.png 1920w,
/static/2501bb1f9597d8370d925c7b8052872a/ba715/connection_stages.png 2210w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/2501bb1f9597d8370d925c7b8052872a/d9199/connection_stages.png"
            alt="connection stages"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Each of these stages can fail or introduce delays. In a world of cellular networks, WiFi handoffs, and varying signal strengths, optimizing each step becomes crucial for a smooth user experience.</p>
<h2 id="its-always-dns" style="position:relative;"><a href="#its-always-dns" aria-label="its always dns permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>It’s always DNS</h2>
<p>DNS resolution is often the forgotten stepchild of network optimization, but it can easily add 50-200ms to the first request to a new domain. Here’s what actually happens during DNS resolution:</p>
<p><strong>DNS Resolution Stages:</strong></p>
<ol>
<li><strong>Local Cache Check</strong> - Device checks its DNS cache</li>
<li><strong>System Resolver</strong> - Query the system’s configured DNS server</li>
<li><strong>Recursive Resolution</strong> - DNS server queries root servers, TLD servers, authoritative servers</li>
<li><strong>Response Propagation</strong> - Result travels back through the chain</li>
</ol>
<p>Each of these stages can fail or be slow, especially on mobile networks where packet loss is common.</p>
<h3 id="dns-subtleties-that-kill-performance" style="position:relative;"><a href="#dns-subtleties-that-kill-performance" aria-label="dns subtleties that kill performance permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DNS Subtleties That Kill Performance</h3>
<ul>
<li><strong>Cache Invalidation</strong>: Low TTL can mean, devices need to resolve DNS frequently which might occur over unreliable or low-bandwidth paths.</li>
<li><strong>Network Switching</strong>: Moving from WiFi to cellular (or vice versa) or fluctuations can clear DNS cache</li>
</ul>
<h3 id="optimizing-dns" style="position:relative;"><a href="#optimizing-dns" aria-label="optimizing dns permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Optimizing DNS</h3>
<p>DNS can be optimized depending on your configurations. For eg. if you have static IPs, you can probably cache them for a longer time and refresh them asynchronously within your app.</p>
<p>If IPs are dynamic, it’s probably not safe to cache them for a longer time but you can try to reduce errors by using a cached or a different static IP in case primary resolution fails.</p>
<p><code class="language-text">okhttp</code> allows you override DNS lookup which you can attach to your <code class="language-text">Builder</code></p>
<div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">class</span> CustomDns <span class="token operator">:</span> Dns <span class="token punctuation">{</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">lookup</span><span class="token punctuation">(</span>hostname<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>InetAddress<span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token comment">// With static IPs, check cache with a bit more relaxed expiry</span>
        <span class="token keyword">val</span> cached <span class="token operator">=</span> <span class="token function">getCachedAddresses</span><span class="token punctuation">(</span>hostname<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> cached
        
        <span class="token keyword">return</span> <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// Fallback to system DNS</span>
            <span class="token keyword">val</span> addresses <span class="token operator">=</span> Dns<span class="token punctuation">.</span>SYSTEM<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>hostname<span class="token punctuation">)</span>
            addresses
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> UnknownHostException<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// With dynamic IPs, try to fallback to preconfigured static IP</span>
            <span class="token function">getStaticAddresses</span><span class="token punctuation">(</span>hostname<span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token keyword">throw</span> e
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">getStaticAddresses</span><span class="token punctuation">(</span>hostname<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>InetAddress<span class="token operator">></span><span class="token operator">?</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>hostname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token string-literal singleline"><span class="token string">"api.myapp.com"</span></span> <span class="token operator">-></span> <span class="token function">listOf</span><span class="token punctuation">(</span>InetAddress<span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"x.xx.xxx.xx"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span> <span class="token operator">-></span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Depending on whether your objective is reliability or performance, overriding DNS resolution can be useful if you have users facing latency or connectivity challenges. I’ll discuss later in the article, how to identify these issues.</p>
<h2 id="ip-addresses-can-deceive" style="position:relative;"><a href="#ip-addresses-can-deceive" aria-label="ip addresses can deceive permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IP addresses can deceive</h2>
<p>DNS returns IP address(es), to one of which a connection must be made. Most modern servers will publish multiple IP addresses which can be often used as means of load balancing or handling requests from different geographies.</p>
<p>Often these are combinations of IPv4 and IPv6, where lies our next challenge.</p>
<p><strong>The Problem:</strong>
IPv6 was launched more than a decade ago, to address (pun intended) exhaustion of IPv4 addresses. Like all large-scale migrations, its quirks are still felt today</p>
<p>Today largely all servers would support IPv6+IPv4, where IPv6 is preferred if available via AAAA record. The clients will prefer the same if they themselves support IPv6 along with a connected network.
Here lies the problem, there are many layers between client, their nearest network and servers which may not be configured for IPv6.</p>
<p><strong>Connection Flow (Traditional):</strong></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/345c6a2821aa513e676eaaac6ea93c8c/e8e04/ip_address_sequential_2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 76.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACMklEQVR42o1Ty27TUBDNn/BDrPgA2KCKDwD1E9jDgk0XCFiVBR/ApgIVUQRJCq3tKo2dJnZsXz+vX9ehlQ4zk7YCKRVZHM21fX1mzpmZwYFt4dn+W+y+f4en+29w4Fjo+ivo1iCpDKywgxO1OA1q2FEHL+lQdz1K+l7UHYI4xyLO5Fw2BoP7L55j8PgB7u0+kcjPkSownQeY+CnG/gqHdoyPQ4/OBid+jaXK4BPRPMzxdWjhaGTD8xOkZYPBh+/f8GjvJXZev8JDivxctyvkukFUNDgJOhxfaIy8Ar/8FlPVSjV5xdEQkYK7iJHpdl1hT/JMf4nWXErsV1fy4Qa66VC1vYDPumXw2SBMCiKMcbFUCFQmCQbrTN0t8msvGHyBfUyrfh3rnsDVNXI3IxXzMMEiSkluva7w72puiQgVmR6VBp+cFIeOwpezFJ8thaGbwZp4mC0TLJMSp5M5fjoekeaUqNtMKFKJUGmD0UxjPCvEwx9ujnPVSDL+Oc4q8e98HiJKS6n6TsIbVN0KqqDOkl++ykWayrVYU5vf1O1UwOc7Jf9baY84rwhayNivM3ch1TAJNyagRJx4K8JKCDWiTKMhAkZI8njmWLLj+rCnPr3TMkr/JWTwRa5iESU0JpF0lj1b0gIc2x7BlaZk2xLqxlyPSYuEZPu0amxFRSvI3jJYyVaSN4Gr5ViblXjKFW/dlE3gbrOPvM8sd2y5tC3p9h5uGnz2i7vvBbTLtM8RNYXn8A8WY1/wjUy5wwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/345c6a2821aa513e676eaaac6ea93c8c/8ac56/ip_address_sequential_2.webp 240w,
/static/345c6a2821aa513e676eaaac6ea93c8c/d3be9/ip_address_sequential_2.webp 480w,
/static/345c6a2821aa513e676eaaac6ea93c8c/e46b2/ip_address_sequential_2.webp 960w,
/static/345c6a2821aa513e676eaaac6ea93c8c/3979e/ip_address_sequential_2.webp 1270w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/345c6a2821aa513e676eaaac6ea93c8c/8ff5a/ip_address_sequential_2.png 240w,
/static/345c6a2821aa513e676eaaac6ea93c8c/e85cb/ip_address_sequential_2.png 480w,
/static/345c6a2821aa513e676eaaac6ea93c8c/d9199/ip_address_sequential_2.png 960w,
/static/345c6a2821aa513e676eaaac6ea93c8c/e8e04/ip_address_sequential_2.png 1270w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/345c6a2821aa513e676eaaac6ea93c8c/d9199/ip_address_sequential_2.png"
            alt="ip address sequential 2"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>The major challenge here is that if you have multiple IPv6 addresses, which are non-functional for certain users, there will be multiple attempts with timeouts (typically 10-15 seconds), before you actually get a connection success, leading to overall latency of 30-60s.</p>
<h3 id="fast-fallback-algorithm" style="position:relative;"><a href="#fast-fallback-algorithm" aria-label="fast fallback algorithm permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fast Fallback Algorithm</h3>
<p>The solution is <a href="https://datatracker.ietf.org/doc/html/rfc6555" target="_blank" rel="nofollow noopener noreferrer">Happy Eyeballs (RFC 8305)</a> - make parallel connection attempts to all available IP addresses and return the fastest successful connection.</p>
<p><strong>Optimized Connection Flow:</strong></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/75cbbefe7c8c8caf5f9f5323e2e6cfa8/6b26f/ip_address_parallel.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 42.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABiUlEQVR42n1Sy06DQBTlF0z8Jn/DuNGtfoN717rUz3CjJi7UdFNNpVZqa3kMMAMDDDBtoznemUqa1MfiZAZuOPc8cG6GLq5dF5OUo9ZLqHaBuGjh5xohIchbZEqjauYoao28aiBVi/L7eRPO1uEuto/2sHNyjJgXCFiK57DBvVfgdsDQDzQmcYlESASpRO9pBHccQJS1Jd0kdvbPT3FwcYbTq0sUpCQrFd54iye/Qn+awWUtmCRVpIzLGsO3wCIk8jgrwbiEKNSacL74gMFy+bneqMyQTrpLtd6u9AKprKzliOdEmtn3TBRrwpyGHX7LpIMkpKRk7McIkgx+LOAzTo5qeO8hqVdWjPMfyQqrjMp2jliUGLzO8DqNkOQVMorBzAx5/n13NlVUjYaX1HicVRhQjiZL0zoji36y+jDJlSUeTSJbjomhK+cHoWo1XiKFuxFHz+N48ARYoRFRXtMwtRZF2eCFihnPGGZMkGVmSzJ5/2m5K6jbXNH/adDNzd3MDOEzqfXpNAq/AFqIoQOvQ/svAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/75cbbefe7c8c8caf5f9f5323e2e6cfa8/8ac56/ip_address_parallel.webp 240w,
/static/75cbbefe7c8c8caf5f9f5323e2e6cfa8/d3be9/ip_address_parallel.webp 480w,
/static/75cbbefe7c8c8caf5f9f5323e2e6cfa8/e46b2/ip_address_parallel.webp 960w,
/static/75cbbefe7c8c8caf5f9f5323e2e6cfa8/f992d/ip_address_parallel.webp 1440w,
/static/75cbbefe7c8c8caf5f9f5323e2e6cfa8/237a5/ip_address_parallel.webp 1658w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/75cbbefe7c8c8caf5f9f5323e2e6cfa8/8ff5a/ip_address_parallel.png 240w,
/static/75cbbefe7c8c8caf5f9f5323e2e6cfa8/e85cb/ip_address_parallel.png 480w,
/static/75cbbefe7c8c8caf5f9f5323e2e6cfa8/d9199/ip_address_parallel.png 960w,
/static/75cbbefe7c8c8caf5f9f5323e2e6cfa8/07a9c/ip_address_parallel.png 1440w,
/static/75cbbefe7c8c8caf5f9f5323e2e6cfa8/6b26f/ip_address_parallel.png 1658w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/75cbbefe7c8c8caf5f9f5323e2e6cfa8/d9199/ip_address_parallel.png"
            alt="ip address parallel"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Thankfully most modern clients support this internally. Chrome, Firefox, even iOS <code class="language-text">UrlSession</code> enable it by default.</p>
<p>In OkHttp, you can enable this with(default since v5.0):</p>
<div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> client <span class="token operator">=</span> OkHttpClient<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">fastFallback</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<h4 id="the-hardware-reality" style="position:relative;"><a href="#the-hardware-reality" aria-label="the hardware reality permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Hardware Reality</h4>
<p>I faced the above problem, when using a different <a href="https://github.com/nats-io/nats.java" target="_blank" rel="nofollow noopener noreferrer">client</a> for networking needs than <code class="language-text">okhttp</code>, where we would find some users running into persistent disconnections over IPv6 addresses.
While clients attempting to connect to IPv6 have been informed by network to use it, the underlying network isn’t actually ready for these addresses. This is largely due to :</p>
<ul>
<li>Cellular tower configuration issues</li>
<li>ISP routing problems</li>
<li>Corporate firewall policies</li>
<li>Home router misconfigurations</li>
</ul>
<p>We later figured out that <strong>~3%</strong> users can’t connect to IPv6, even when DNS resolves it for them and end up connecting to IPv4 addresses. It is also more likely to happen on a wifi connection than a cellular one.</p>
<h2 id="making-attempts-faster" style="position:relative;"><a href="#making-attempts-faster" aria-label="making attempts faster permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Making attempts faster</h2>
<p>Clients often come up with a default set of values around timeouts, optimisations which might be counterintuitive in certain use cases. For example, <code class="language-text">okhttp</code> has</p>
<ul>
<li>Default timeout of 10s for connections</li>
<li>Default timeout of 10s for read/write requests.</li>
<li>Max 5 concurrent calls per host, while limiting it to 64 globally.</li>
</ul>
<p>Increasing concurrent calls per host might be worth it if all calls use the same host, which can be the usual case for mobile apps.</p>
<p>In terms of timeout, it might be worth experimenting if failing fast with lower timeouts helps with app experience. It also forces you to look at your own infrastructure in terms of what you need to change to reach users in let’s say &#x3C;5 seconds.</p>
<p>Another advantage here is faster timeouts can capture degraded TCP connections faster. Let me take an HTTP detour to expand on this.</p>
<h3 id="http-1--2" style="position:relative;"><a href="#http-1--2" aria-label="http 1  2 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTTP 1 &#x26; 2</h3>
<p>HTTP 1 makes requests over connection sequentially, which means if one request is slow, all others in line become slow as well. This can be mitigated by creating a bunch of connections and splitting requests over them.</p>
<p>HTTP2 solves this by multiplexing requests over a single connection as different streams, which can be dispatched and returned in any sequence.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/99f1dfa4e8fc6ceb4cd730b5705ddbe2/ea64c/http1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABn0lEQVR42m1S2ZLaMBD0//9ZjkqAcC1mA75PyYcsyTx1ZmZx2IJ96NJIdrempxX0k8dg5xecK4uwtLKea/eB+1nROYzulcNagR4tam3QdAZtPxEMSj3h23XCJveCVTIJ/hQev1OPkIT1YIg3yv/MY35nHALeZLXGe5wjLhoUjUZc9/gRWexJ4FDO+HXpsIoGHKneZA4n6rLRPS5pJbysVqLRGYtgsF7a53YZXCvj8TOesC2cYEfCu9JLvSbBv43D5B82eV00Am7zGQN9yGlOcWuRqFeo8ZXDEMHHDbf/w9V0tkktdebItiPbXsD1NneIWgdzD+UzTwTVMNHceiRli5zmULY90mbE98iK1T3P8NpjFY8yz/V9hi0FkpQKadUSvxMNCUUNFpUaRZAH2+gBOe055S0lvCtmEVsnhuZINaV84pQpXf4/KRtpoiKeCH62vLytjs4OZO+tnnEihM2N1pvUx2pGqh6WjX+yvKTb3bFcwDfyM0orJV1k1Yc9xlecBUH/dMBtc6fXrML6cMY+vGIXXnB8j3A4R7JfEv0K/wAA5j4U/eJGpAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/99f1dfa4e8fc6ceb4cd730b5705ddbe2/8ac56/http1.webp 240w,
/static/99f1dfa4e8fc6ceb4cd730b5705ddbe2/d3be9/http1.webp 480w,
/static/99f1dfa4e8fc6ceb4cd730b5705ddbe2/e46b2/http1.webp 960w,
/static/99f1dfa4e8fc6ceb4cd730b5705ddbe2/36c36/http1.webp 1116w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/99f1dfa4e8fc6ceb4cd730b5705ddbe2/8ff5a/http1.png 240w,
/static/99f1dfa4e8fc6ceb4cd730b5705ddbe2/e85cb/http1.png 480w,
/static/99f1dfa4e8fc6ceb4cd730b5705ddbe2/d9199/http1.png 960w,
/static/99f1dfa4e8fc6ceb4cd730b5705ddbe2/ea64c/http1.png 1116w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/99f1dfa4e8fc6ceb4cd730b5705ddbe2/d9199/http1.png"
            alt="http1"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/25186e8adc3c7b94e53671fd96573159/62a6a/http2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABKklEQVR42m2Q21LCQBBE+f9PsxRFKQUNkL0Rks39sgRf2pkJBMvyoXd2ku1TM72o+4C6P4uqLqCh6soBygfo/KZBKn9zZZjf/vZV3XRf2LTATh+hjxlcViLxFZa6x9IErI9nvJHWyShV5AKSooVNc0Tki10K5yefAFXisd1r7AxBTx7qVODVDXi2AZtsxMq0eIg8PtIR7yeG0pR5A0UDsC9SDszgYQQYO4/N7vqDHhkCPtGEj2ogcMCLJbjpsaK7yE7A2GXi+4qt3HlTAfL+ed2haHqULWcYcKDMVHmBqb6hq6ka6uNihMrDlFnLvv7qG+ZMF3w0w0g6zyELlCKIYoODTaBI3Ce+QBfG+zvx3fsZ+Fc8Ka+z/txL3R4MNpSXpqzacEH1j+cG/AEU1Q05XpvKGwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/25186e8adc3c7b94e53671fd96573159/8ac56/http2.webp 240w,
/static/25186e8adc3c7b94e53671fd96573159/d3be9/http2.webp 480w,
/static/25186e8adc3c7b94e53671fd96573159/e46b2/http2.webp 960w,
/static/25186e8adc3c7b94e53671fd96573159/e6b69/http2.webp 1122w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/25186e8adc3c7b94e53671fd96573159/8ff5a/http2.png 240w,
/static/25186e8adc3c7b94e53671fd96573159/e85cb/http2.png 480w,
/static/25186e8adc3c7b94e53671fd96573159/d9199/http2.png 960w,
/static/25186e8adc3c7b94e53671fd96573159/62a6a/http2.png 1122w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/25186e8adc3c7b94e53671fd96573159/d9199/http2.png"
            alt="http2"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>The only blocker here is the TCP connection here itself, since TCP acknowledges every packet sent, a packet loss at any request will pause all request streams until lost packet is retrieved. Packet loss is more prevalent in fluctuating mobile networks.</p>
<p>Shorter timeouts can force clients to revalidate their connection <a href="https://github.com/square/okhttp/blob/4e7860212f3d873b37b69e4f0a882cf60bb91dd7/okhttp/src/commonJvmAndroid/kotlin/okhttp3/internal/http2/Http2Connection.kt#L530" target="_blank" rel="nofollow noopener noreferrer">health</a> faster, upon which you can fail fast and retry on a newer (hopefully better) path when the network is fluctuating.</p>
<p><strong>Timeout Strategy:</strong></p>
<div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> client <span class="token operator">=</span> OkHttpClient<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">connectTimeout</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">readTimeout</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p><strong>Parallel Connection Limits:</strong></p>
<div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> dispatcher <span class="token operator">=</span> <span class="token function">Dispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
dispatcher<span class="token punctuation">.</span>maxRequestsPerHost <span class="token operator">=</span> <span class="token number">10</span>

<span class="token keyword">val</span> client <span class="token operator">=</span> OkHttpClient<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">dispatcher</span><span class="token punctuation">(</span>dispatcher<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<h2 id="http3-return-of-udp" style="position:relative;"><a href="#http3-return-of-udp" aria-label="http3 return of udp permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTTP3: Return of UDP</h2>
<p>HTTP/3 uses <a href="https://www.chromium.org/quic/" target="_blank" rel="nofollow noopener noreferrer">QUIC</a> protocol, which runs over UDP instead of TCP. This solves several fundamental issues with TCP:</p>
<p><strong>TCP Problems QUIC Solves:</strong></p>
<ul>
<li><strong>Head-of-line blocking</strong>: One lost packet blocks all streams</li>
<li><strong>Connection setup</strong>: Requires multiple round trips</li>
<li><strong>Mobility</strong>: Connections break when switching networks</li>
</ul>
<p><strong>Mobile-Specific Advantages:</strong></p>
<ul>
<li><strong>Connection Migration</strong>: Maintains connection when switching from WiFi to Mobile</li>
<li><strong>Better Loss Recovery</strong>: Per-stream recovery instead of connection-wide</li>
<li><strong>Reduced Latency</strong>: Built-in encryption, no separate TLS handshake</li>
</ul>
<p>Unfortunately, <code class="language-text">okhttp</code> doesn’t support HTTP3 natively, but we can use Google’s <a href="https://developer.android.com/develop/connectivity/cronet" target="_blank" rel="nofollow noopener noreferrer">Cronet</a> library, which can also plug into <code class="language-text">okhttp</code> stack but with limited <a href="https://github.com/google/cronet-transport-for-okhttp" target="_blank" rel="nofollow noopener noreferrer">features</a>.</p>
<p><strong>Fun side note</strong></p>
<p>Google introduced <a href="https://www.chromium.org/spdy/spdy-whitepaper/" target="_blank" rel="nofollow noopener noreferrer">SPDY</a> protocol to overcome HTTP1 limitations, which eventually was used in HTTP2. Same is repeated with QUIC, which was introduced by Google and eventually made it’s way to HTTP3.</p>
<h2 id="measurement" style="position:relative;"><a href="#measurement" aria-label="measurement permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Measurement</h2>
<p>If using <code class="language-text">okhttp</code> , you can attach an <code class="language-text">EventListener</code> to the <code class="language-text">Builder</code>, which can then be used to measure different stages of http calls.</p>
<div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">class</span> MetricsListener <span class="token operator">:</span> <span class="token function">EventListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">callEnd</span><span class="token punctuation">(</span>call<span class="token operator">:</span> Call<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">callStart</span><span class="token punctuation">(</span>call<span class="token operator">:</span> Call<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">connectStart</span><span class="token punctuation">(</span>call<span class="token operator">:</span> Call<span class="token punctuation">,</span> inetSocketAddress<span class="token operator">:</span> InetSocketAddress<span class="token punctuation">,</span> proxy<span class="token operator">:</span> Proxy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">connectEnd</span><span class="token punctuation">(</span>
        call<span class="token operator">:</span> Call<span class="token punctuation">,</span>
        inetSocketAddress<span class="token operator">:</span> InetSocketAddress<span class="token punctuation">,</span>
        proxy<span class="token operator">:</span> Proxy<span class="token punctuation">,</span>
        protocol<span class="token operator">:</span> Protocol<span class="token operator">?</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">dnsStart</span><span class="token punctuation">(</span>call<span class="token operator">:</span> Call<span class="token punctuation">,</span> domainName<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">dnsEnd</span><span class="token punctuation">(</span>call<span class="token operator">:</span> Call<span class="token punctuation">,</span> domainName<span class="token operator">:</span> String<span class="token punctuation">,</span> inetAddressList<span class="token operator">:</span> List<span class="token operator">&lt;</span>InetAddress<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">secureConnectStart</span><span class="token punctuation">(</span>call<span class="token operator">:</span> Call<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">secureConnectEnd</span><span class="token punctuation">(</span>call<span class="token operator">:</span> Call<span class="token punctuation">,</span> handshake<span class="token operator">:</span> Handshake<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">EventListener</code> is quite extensive, and can be used to get metrics around cache hit, dns, SSL and much more. You can push these metrics to your favorite analytics/observability system and analyze patterns around carrier, geography etc.</p>
<h2 id="conclusion" style="position:relative;"><a href="#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>Just like spread spectrum technology spread signals across multiple frequencies to survive interference, modern mobile apps need to spread their bets across multiple optimization strategies. DNS caching handles resolution failures, fast fallback survives IPv6 connectivity issues, aggressive timeouts help recover from degraded connections, and HTTP/3 promises to solve fundamental TCP limitations.</p>
<p>The network will always be unreliable - that’s the one constant we can count on. But by understanding each stage of the network journey and optimizing for the realities of mobile communication, we can build apps that feel fast and reliable even when the underlying infrastructure isn’t.</p>
<p>Next time a user complains about network performance, you’ll know it’s not just “the network is slow” - it’s a complex chain of optimizable steps waiting to be fine-tuned.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 710px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/26fa0c720c4397587e1628200f923dc0/67e9d/meme.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 49.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABAUA/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABpz1To0fiZH//xAAaEAEAAgMBAAAAAAAAAAAAAAABAgMAETIS/9oACAEBAAEFAnXpVtjeA8QXIc//xAAXEQEAAwAAAAAAAAAAAAAAAAAAAQIh/9oACAEDAQE/AYsx/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bh//EABwQAAEDBQAAAAAAAAAAAAAAAAACETEBEEJxgf/aAAgBAQAGPwJx0v0iorRONv/EABsQAQADAAMBAAAAAAAAAAAAAAEAESExQWHR/9oACAEBAAE/IXbaV4Bd46jgV3zJzu/iMdXCJRbc/9oADAMBAAIAAwAAABCzH//EABcRAQADAAAAAAAAAAAAAAAAAAARQXH/2gAIAQMBAT8Qgph//8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERUf/aAAgBAgEBPxBl3T//xAAaEAEBAAMBAQAAAAAAAAAAAAABEQAhUUGx/9oACAEBAAE/EKEAAX7lXUtiPGSy6ldHMBokKPpgTTs2+3HZF1bn/9k='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/26fa0c720c4397587e1628200f923dc0/8ac56/meme.webp 240w,
/static/26fa0c720c4397587e1628200f923dc0/d3be9/meme.webp 480w,
/static/26fa0c720c4397587e1628200f923dc0/457aa/meme.webp 710w"
              sizes="(max-width: 710px) 100vw, 710px"
              type="image/webp"
            />
          <source
            srcset="/static/26fa0c720c4397587e1628200f923dc0/09b79/meme.jpg 240w,
/static/26fa0c720c4397587e1628200f923dc0/7cc5e/meme.jpg 480w,
/static/26fa0c720c4397587e1628200f923dc0/67e9d/meme.jpg 710w"
            sizes="(max-width: 710px) 100vw, 710px"
            type="image/jpeg"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/26fa0c720c4397587e1628200f923dc0/67e9d/meme.jpg"
            alt="meme"
            title=""
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p></div></div></div><div class="post-module--footer--87cff"><div class="post-footer-module--post-footer--9c13c"><p class="post-footer-module--date--abfe9">Published<!-- --> <!-- -->Aug 5, 2025</p></div><ul class="post-tags-module--post-tags--6c235"><li class="post-tags-module--item--53595"><a class="button-module--button--5ffa9" href="/tag/android/">Android</a></li><li class="post-tags-module--item--53595"><a class="button-module--button--5ffa9" href="/tag/network/">Network</a></li></ul><div class="post-author-module--post-author--2247e"><p class="post-author-module--description--78aeb"><a class="post-author-module--x--f2941" href="https://www.x.com/_jitinsharma" rel="noopener noreferrer" target="_blank"><strong>Jitin Sharma</strong> on X</a></p></div></div><div class="social-share-module--socialShare--2c4d2"><h4 class="social-share-module--title--28c75">Share this post</h4><div class="social-share-module--buttons--1fc6d"><button class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="32" fill="#000000"></circle><path d="M 41.116 18.375 h 4.962 l -10.8405 12.39 l 12.753 16.86 H 38.005 l -7.821 -10.2255 L 21.235 47.625 H 16.27 l 11.595 -13.2525 L 15.631 18.375 H 25.87 l 7.0695 9.3465 z m -1.7415 26.28 h 2.7495 L 24.376 21.189 H 21.4255 z" fill="white"></path></svg></button><button class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="32" fill="#0077B5"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="32" height="32"><circle cx="32" cy="32" r="32" fill="#FF5700"></circle><path d="M 53.34375 32 C 53.277344 30.160156 52.136719 28.53125 50.429688 27.839844 C 48.722656 27.148438 46.769531 27.523438 45.441406 28.800781 C 41.800781 26.324219 37.519531 24.957031 33.121094 24.863281 L 35.199219 14.878906 L 42.046875 16.320312 C 42.214844 17.882812 43.496094 19.09375 45.066406 19.171875 C 46.636719 19.253906 48.03125 18.183594 48.359375 16.644531 C 48.6875 15.105469 47.847656 13.558594 46.382812 12.992188 C 44.914062 12.425781 43.253906 13.007812 42.464844 14.367188 L 34.625 12.800781 C 34.363281 12.742188 34.09375 12.792969 33.871094 12.9375 C 33.648438 13.082031 33.492188 13.308594 33.441406 13.566406 L 31.070312 24.671875 C 26.617188 24.738281 22.277344 26.105469 18.59375 28.609375 C 17.242188 27.339844 15.273438 26.988281 13.570312 27.707031 C 11.863281 28.429688 10.746094 30.089844 10.71875 31.941406 C 10.691406 33.789062 11.757812 35.484375 13.441406 36.257812 C 13.402344 36.726562 13.402344 37.195312 13.441406 37.664062 C 13.441406 44.832031 21.792969 50.65625 32.097656 50.65625 C 42.398438 50.65625 50.753906 44.832031 50.753906 37.664062 C 50.789062 37.195312 50.789062 36.726562 50.753906 36.257812 C 52.363281 35.453125 53.371094 33.800781 53.34375 32 Z M 21.34375 35.199219 C 21.34375 33.433594 22.777344 32 24.542969 32 C 26.3125 32 27.742188 33.433594 27.742188 35.199219 C 27.742188 36.96875 26.3125 38.398438 24.542969 38.398438 C 22.777344 38.398438 21.34375 36.96875 21.34375 35.199219 Z M 39.9375 44 C 37.664062 45.710938 34.871094 46.582031 32.03125 46.464844 C 29.191406 46.582031 26.398438 45.710938 24.128906 44 C 23.847656 43.65625 23.871094 43.15625 24.183594 42.839844 C 24.5 42.527344 25 42.503906 25.34375 42.785156 C 27.269531 44.195312 29.617188 44.90625 32 44.800781 C 34.386719 44.929688 36.746094 44.242188 38.6875 42.847656 C 39.042969 42.503906 39.605469 42.511719 39.953125 42.863281 C 40.296875 43.21875 40.289062 43.785156 39.9375 44.128906 Z M 39.359375 38.527344 C 37.59375 38.527344 36.160156 37.09375 36.160156 35.328125 C 36.160156 33.5625 37.59375 32.128906 39.359375 32.128906 C 41.128906 32.128906 42.558594 33.5625 42.558594 35.328125 C 42.59375 36.203125 42.269531 37.054688 41.65625 37.6875 C 41.046875 38.316406 40.203125 38.664062 39.328125 38.65625 Z M 39.359375 38.527344" fill="white"></path></svg></button></div></div><div class="post-module--comments--82b11"><div id="disqus_thread"></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/finding-network-in-a-haystack/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-d6f3d61ccb282fb8165b.js\"],\"component---src-templates-categories-template-tsx\":[\"/component---src-templates-categories-template-tsx-859e35c587acf71c198b.js\"],\"component---src-templates-category-template-tsx\":[\"/component---src-templates-category-template-tsx-31dcf2f4c6782b6daf76.js\"],\"component---src-templates-index-template-tsx\":[\"/component---src-templates-index-template-tsx-b04e8e72be728a8bb3b0.js\"],\"component---src-templates-not-found-template-tsx\":[\"/component---src-templates-not-found-template-tsx-014aeb08e620be2c6f06.js\"],\"component---src-templates-page-template-tsx\":[\"/component---src-templates-page-template-tsx-143dc7e75923189f89b7.js\"],\"component---src-templates-post-template-tsx\":[\"/component---src-templates-post-template-tsx-bdb4c35f343f99184056.js\"],\"component---src-templates-presentation-template-tsx\":[\"/component---src-templates-presentation-template-tsx-8f5dea1083b790ad0dd2.js\"],\"component---src-templates-tag-template-tsx\":[\"/component---src-templates-tag-template-tsx-3162a4350edddef38bdd.js\"],\"component---src-templates-tags-template-tsx\":[\"/component---src-templates-tags-template-tsx-a419c2550704f45dac49.js\"],\"component---src-templates-talks-template-tsx\":[\"/component---src-templates-talks-template-tsx-8490d78219e6e96dc559.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="9afc5b473ea36f127212";</script><script src="/webpack-runtime-3d1c01f4863f820f5d60.js" async></script><script src="/framework-c2bc3b87683eb14081d4.js" async></script><script src="/d904c7bf-6421a2795df996456d37.js" async></script><script src="/app-d6f3d61ccb282fb8165b.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>